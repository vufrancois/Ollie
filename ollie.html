<html>
  <head>
    <style>
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script >
      // This example adds an animated symbol to a polyline.

      function initMap() {
        var markerArray = [];
        // Instantiate a directions service.
        var directionsService = new google.maps.DirectionsService;
        
        // Create a map and center it on Manhattan.
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 100,
          center: {lat: 40.771, lng: -73.974}
        });
        
        // Create a renderer for directions and bind it to the map.
        var directionsDisplay = new google.maps.DirectionsRenderer({map: map});

        // Instantiate an info window to hold step text.
        var contentString = "HELLO";
        var stepDisplay = new google.maps.InfoWindow({
          content: contentString
        });
        
        
        // Define the symbol, using one of the predefined paths ('CIRCLE')
        // supplied by the Google Maps JavaScript API.
        var lineSymbol = {
          path: "M17.402,0H5.643C2.526,0,0,3.467,0,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759c3.116,0,5.644-2.527,5.644-5.644 V6.584C23.044,3.467,20.518,0,17.402,0z M22.057,14.188v11.665l-2.729,0.351v-4.806L22.057,14.188z M20.625,10.773 c-1.016,3.9-2.219,8.51-2.219,8.51H4.638l-2.222-8.51C2.417,10.773,11.3,7.755,20.625,10.773z M3.748,21.713v4.492l-2.73-0.349 V14.502L3.748,21.713z M1.018,37.938V27.579l2.73,0.343v8.196L1.018,37.938z M2.575,40.882l2.218-3.336h13.771l2.219,3.336H2.575z M19.328,35.805v-7.872l2.729-0.355v10.048L19.328,35.805z",
          scale: .7,
          strokeColor: "white",
          strokeWeight: .10,
          fillOpacity: 1,
          fillColor: "#404040",
          offset: "5%",
          // rotation: parseInt(heading[i]),
          anchor: new google.maps.Point(10, 25)
        };

        // Create the polyline and add the symbol to it via the 'icons' property.
        var line = new google.maps.Polyline({
          path: [],
          icons: [{
            icon: lineSymbol,
            offset: '100%'
          }],
          map: map
        });

        var path = [];
      // Display the route between the initial start and end selections.
        calculateAndDisplayRoute(
          directionsDisplay, directionsService, markerArray, stepDisplay, map, line, path);

        animateCircle(line);
        showStats(line);
      }

      // Use the DOM setInterval() function to change the offset of the symbol
      // at fixed intervals.
      function animateCircle(line) {
          var count = 0;
          window.setInterval(function() {
            count = (count + 1) % 1000000;

            var icons = line.get('icons');
            icons[0].offset = (count / 100) + '%';
            line.set('icons', icons);
        }, 20);
      }

      function calculateAndDisplayRoute(directionsDisplay, directionsService,
                                         markerArray, stepDisplay, map, line, path) {
        // First, remove any existing markers from the map.
        for (var i = 0; i < markerArray.length; i++) {
          markerArray[i].setMap(null);
        }

        // Retrieve the start and end locations and create a DirectionsRequest using
        // WALKING directions.
        directionsService.route({
          origin: "penn station, new york, ny",
          destination: "253 West 125th Street, New York, NY",
          travelMode: 'DRIVING'
        }, function(response, status) {
          // Route the directions and pass the response to a function to create
          // markers for each step.
          if (status === 'OK') {
            // parse waypoints
            directionsDisplay.setDirections(response);
            path = showSteps(response, markerArray, stepDisplay, map, path);
            console.log(path);
            line.setPath(path);
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }

      function showSteps(directionResult, markerArray, stepDisplay, map, path) {
        // For each step, place a marker, and add the text to the marker's infowindow.
        // Also attach the marker to an array so we can keep track of it and remove it
        // when calculating new routes.
        var myRoute = directionResult.routes[0].legs[0];
        for (var i = 0; i < myRoute.steps.length; i++) {
          var marker = markerArray[i] = markerArray[i] || new google.maps.Marker;
          // add to path
          if (i == 0) {
            path.push(myRoute.steps[i].start_location);
          }
          path.push(myRoute.steps[i].end_location);
          attachInstructionText(
            stepDisplay, marker, myRoute.steps[i].instructions, map);
        }
        return path
      }

      function attachInstructionText(stepDisplay, marker, text, map) {
        google.maps.event.addListener(marker, 'click', function() {
          // Open an info window when the marker is clicked on, containing the text
          // of the step.
          stepDisplay.setContent(text);
          stepDisplay.open(map, marker);
        });
      }

      function showStats(line) {
        google.maps.event.add
      }
    </script>
  </head>
  <body>
    <div id="map"></div>
    <script async defer
src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap">
</script>
  </body>
</html>